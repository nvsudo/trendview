<div class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
  <!-- Portfolio Header -->
  <div class="mb-8">
    <h1 class="text-3xl font-bold text-gray-900">Portfolio Overview</h1>
    <p class="mt-2 text-gray-600">Current positions and account allocation across your trading accounts.</p>
  </div>

  <!-- Portfolio Summary -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
    <div class="bg-white overflow-hidden shadow rounded-lg">
      <div class="p-5">
        <div class="flex items-center">
          <div class="flex-shrink-0">
            <div class="text-2xl">üíº</div>
          </div>
          <div class="ml-5 w-0 flex-1">
            <dl>
              <dt class="text-sm font-medium text-gray-500 truncate">Open Positions</dt>
              <dd class="text-lg font-medium text-gray-900"><%= @open_positions.count %></dd>
            </dl>
          </div>
        </div>
      </div>
    </div>

    <div class="bg-white overflow-hidden shadow rounded-lg">
      <div class="p-5">
        <div class="flex items-center">
          <div class="flex-shrink-0">
            <div class="text-2xl">üí∞</div>
          </div>
          <div class="ml-5 w-0 flex-1">
            <dl>
              <dt class="text-sm font-medium text-gray-500 truncate">Total Position Value</dt>
              <dd class="text-lg font-medium text-gray-900">
                ‚Çπ<%= number_with_delimiter(@open_positions.sum(&:position_value).round(2)) %>
              </dd>
            </dl>
          </div>
        </div>
      </div>
    </div>

    <div class="bg-white overflow-hidden shadow rounded-lg">
      <div class="p-5">
        <div class="flex items-center">
          <div class="flex-shrink-0">
            <div class="text-2xl">üìä</div>
          </div>
          <div class="ml-5 w-0 flex-1">
            <dl>
              <dt class="text-sm font-medium text-gray-500 truncate">Unrealized P&L</dt>
              <dd class="text-lg font-medium <%= @total_unrealized_pnl >= 0 ? 'text-green-600' : 'text-red-600' %>">
                <%= @total_unrealized_pnl >= 0 ? '+' : '' %>‚Çπ<%= number_with_delimiter(@total_unrealized_pnl.round(2)) %>
              </dd>
            </dl>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Trading Accounts -->
  <div class="bg-white shadow rounded-lg mb-8">
    <div class="px-4 py-5 sm:p-6">
      <h3 class="text-lg leading-6 font-medium text-gray-900 mb-4">Trading Accounts</h3>

      <% if @trading_accounts.any? %>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          <% @trading_accounts.each do |account| %>
            <div class="border border-gray-200 rounded-lg p-4">
              <div class="flex justify-between items-start mb-2">
                <h4 class="font-medium text-gray-900"><%= account.account_name %></h4>
                <% if account.is_primary %>
                  <span class="px-2 py-1 text-xs font-semibold rounded-full bg-orange-100 text-orange-800">Primary</span>
                <% end %>
              </div>
              <p class="text-sm text-gray-600"><%= account.broker_name %></p>
              <p class="text-xs text-gray-500 mt-1">
                <%= account.account_type.humanize %> Account
              </p>
              <div class="mt-3">
                <%= link_to "View Details", trading_account_path(account),
                    class: "text-orange-600 hover:text-orange-700 text-sm font-medium" %>
              </div>
            </div>
          <% end %>
        </div>

        <div class="mt-4">
          <%= link_to "Manage Accounts", trading_accounts_path,
              class: "text-orange-600 hover:text-orange-700 font-medium" %>
        </div>
      <% else %>
        <div class="text-center py-8">
          <div class="text-4xl mb-4">üè¶</div>
          <h3 class="text-lg font-medium text-gray-900 mb-2">No trading accounts connected</h3>
          <p class="text-gray-500 mb-4">Connect your Zerodha account to start tracking your portfolio.</p>
          <%= link_to "Connect Account", new_trading_account_path,
              class: "bg-orange-600 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-orange-700" %>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Open Positions -->
  <div class="bg-white shadow rounded-lg">
    <div class="px-4 py-5 sm:p-6">
      <h3 class="text-lg leading-6 font-medium text-gray-900 mb-4">Open Positions</h3>

      <% if @open_positions.any? %>
        <div class="overflow-x-auto">
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
              <tr>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Security</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Quantity</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Entry Price</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Current Value</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Unrealized P&L</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Entry Date</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
              <% @open_positions.each do |position| %>
                <tr class="hover:bg-gray-50">
                  <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                    <%= position.security&.company_name || "N/A" %>
                    <div class="text-xs text-gray-500"><%= position.security&.symbol %></div>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                    <%= number_with_delimiter(position.quantity) %>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                    ‚Çπ<%= number_with_delimiter(position.entry_price) %>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                    ‚Çπ<%= number_with_delimiter(position.current_value.round(2)) %>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                    <span class="<%= position.unrealized_pnl >= 0 ? 'text-green-600' : 'text-red-600' %>">
                      <%= position.formatted_unrealized_pnl %>
                    </span>
                    <div class="text-xs text-gray-500">
                      (<%= position.unrealized_pnl_percent %>%)
                    </div>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                    <%= position.entry_date.strftime("%d %b %Y") %>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      <% else %>
        <div class="text-center py-12">
          <div class="text-6xl mb-4">üìä</div>
          <h3 class="text-lg font-medium text-gray-900 mb-2">No open positions</h3>
          <p class="text-gray-500 mb-6">Add a new trade to start building your portfolio.</p>
          <%= link_to "Add New Trade", new_trade_path,
              class: "bg-orange-600 text-white px-6 py-3 rounded-md text-sm font-medium hover:bg-orange-700" %>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Back to Dashboard -->
  <div class="mt-8">
    <%= link_to "‚Üê Back to Dashboard", root_path, class: "text-orange-600 hover:text-orange-700 font-medium" %>
  </div>
</div>
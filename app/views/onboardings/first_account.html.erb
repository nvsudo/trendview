<div class="min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8">
  <div class="max-w-2xl w-full space-y-8">
    <!-- Progress Bar -->
    <div class="mb-8">
      <div class="flex justify-between items-center mb-2">
        <span class="text-sm font-medium text-gray-700">Step 3 of 4</span>
        <span class="text-sm text-gray-500"><%= @progress %>% Complete</span>
      </div>
      <div class="w-full bg-gray-200 rounded-full h-2">
        <div class="bg-orange-600 h-2 rounded-full transition-all duration-300" style="width: <%= @progress %>%"></div>
      </div>
    </div>

    <div>
      <div class="mx-auto h-12 w-12 flex items-center justify-center">
        <span class="text-4xl">üíº</span>
      </div>
      <h2 class="mt-6 text-center text-3xl font-extrabold text-gray-900">
        Add your first trading account
      </h2>
      <p class="mt-2 text-center text-sm text-gray-600">
        We'll track your trades and portfolio performance from this account
      </p>
    </div>

    <%= form_with url: user_path(current_user), method: :patch, local: true, class: "mt-8" do |form| %>
      <%= hidden_field_tag :step_name, "first_account" %>

      <div class="bg-white rounded-lg shadow-md p-8 space-y-6">
        <!-- Account Name -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">
            Account Name
          </label>
          <%= text_field_tag 'step_data[account_name]', @account_name,
              placeholder: "e.g., My Zerodha Account",
              required: true,
              class: "appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-orange-500 focus:border-orange-500 focus:z-10 sm:text-sm" %>
          <p class="mt-1 text-sm text-gray-500">Give this account a memorable name</p>
        </div>

        <!-- Account Type -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">
            Account Type
          </label>
          <%= select_tag 'step_data[account_type]',
              options_for_select([
                ['Select type...', ''],
                ['Trading Account', 'trading'],
                ['Demat Account', 'demat'],
                ['Practice/Paper Trading', 'paper']
              ], @account_type),
              required: true,
              class: "appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 text-gray-900 focus:outline-none focus:ring-orange-500 focus:border-orange-500 focus:z-10 sm:text-sm" %>
        </div>

        <!-- Broker -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">
            Broker
          </label>
          <%= select_tag 'step_data[broker]',
              options_for_select([
                ['Select broker...', ''],
                ['Zerodha', 'zerodha'],
                ['Interactive Brokers', 'interactive_brokers'],
                ['Upstox', 'upstox'],
                ['Angel One', 'angel_one'],
                ['ICICI Direct', 'icici_direct'],
                ['Groww', 'groww'],
                ['Fyers', 'fyers'],
                ['Other', 'other']
              ], @broker),
              required: true,
              class: "appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 text-gray-900 focus:outline-none focus:ring-orange-500 focus:border-orange-500 focus:z-10 sm:text-sm" %>
        </div>

        <!-- Starting Cash -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">
            Starting Cash to Deploy (optional)
          </label>
          <div class="flex gap-2">
            <%= select_tag 'step_data[currency]',
                options_for_select([
                  ['INR', 'INR'],
                  ['USD', 'USD'],
                  ['EUR', 'EUR'],
                  ['GBP', 'GBP']
                ], @currency || 'INR'),
                class: "w-24 appearance-none rounded-md px-3 py-2 border border-gray-300 text-gray-900 focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm" %>
            <%= text_field_tag 'cash_display', @account_size ? number_with_delimiter(@account_size, delimiter: ',') : nil,
                placeholder: "2,50,000",
                id: "cash_amount",
                class: "flex-1 appearance-none rounded-md px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm" %>
            <%= hidden_field_tag 'step_data[account_size]', @account_size, id: 'cash_amount_raw' %>
          </div>
          <p class="mt-1 text-sm text-gray-500">Enter the cash available for trading (this is your initial capital injection)</p>
        </div>

        <div class="bg-blue-50 border border-blue-200 rounded-md p-4">
          <div class="flex">
            <div class="flex-shrink-0">
              <span class="text-blue-600">‚ÑπÔ∏è</span>
            </div>
            <div class="ml-3 text-sm text-blue-800">
              <p>Don't worry! This is just to set up your account structure. You'll be able to connect to Zerodha or manually import trades in the next step.</p>
            </div>
          </div>
        </div>

        <div class="pt-4">
          <%= form.submit "Continue ‚Üí", class: "w-full flex justify-center py-3 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-orange-600 hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500" %>
        </div>

        <div class="text-center">
          <%= link_to "‚Üê Back", trading_profile_onboarding_path, class: "text-sm text-gray-600 hover:text-gray-900" %>
        </div>
      </div>
    <% end %>
  </div>
</div>

<script>
  // Format cash amount with commas as user types
  const cashInput = document.getElementById('cash_amount');
  const cashRaw = document.getElementById('cash_amount_raw');

  if (cashInput) {
    cashInput.addEventListener('input', function(e) {
      // Remove all non-digit characters
      let value = e.target.value.replace(/[^\d]/g, '');

      // Store the raw value
      cashRaw.value = value;

      // Format with commas
      if (value) {
        // Convert to number and format with commas
        e.target.value = parseInt(value).toLocaleString('en-IN');
      }
    });

    // On form submit, ensure raw value is set
    cashInput.closest('form').addEventListener('submit', function() {
      if (cashInput.value) {
        cashRaw.value = cashInput.value.replace(/[^\d]/g, '');
      }
    });
  }
</script>
